var a=document.getElementById('fileInput'),b=document.getElementById('fileList'),c=document.getElementById('convertAllBtn'),d=document.getElementById('bulkDownloadBtn'),A=document.getElementById('clearAllBtn'),f=[];a.addEventListener('change',_=>{var B=[..._.target.files];for(const _a of B){var C=f.length,D=_a.name.replace(/\.\w+$/,'');f.push({id:C,file:_a,convertedUrl:null,filename:D});g(C,_a,D)}f.length>0&&(c.style.display='inline-block',A.style.display='inline-block')});function g(_A,_b,_c){var _d=document.createElement('div');_d.className='file-item';_d.dataset.id=_A;var E=new FileReader;E.onload=e=>{_d.innerHTML=`
      <img src="${e.target.result}" alt="Image Preview">
      <span class="editable-filename" contenteditable="true">${_c}</span>
      <button class="convertBtn">Convert</button>
      <a class="downloadLink" style="display: none;" download="${_c}.${toFormat}">Download</a>
      <button class="deleteBtn">‚ùå</button>
      <div class="progress">
        <div class="progress-bar"></div>
      </div>
    `;b.appendChild(_d);var _B=_d.querySelector('.editable-filename'),_D=_d.querySelector('.downloadLink'),_e=_d.querySelector('.deleteBtn');_B.addEventListener('input',()=>h(_A,_B.textContent));var _C=_d.querySelector('.convertBtn');_C.addEventListener('click',()=>i(_A,_D,_d));_e.addEventListener('click',()=>j(_A,_d))};E.readAsDataURL(_b)}function h(aA,aB){if(f[aA]){f[aA].filename=aB;var aC=b.querySelector(`[data-id='${aA}']`),aD=aC.querySelector('.downloadLink');aD&&(aD.download=`${aB}.${toFormat}`)}}function i(aE,aF,aG){var aH=aG.querySelector('.progress-bar');var _E=new FileReader;_E.onload=e=>{var aI=new Image;aI.src=e.target.result;aI.onload=()=>{var aJ=document.createElement('canvas'),aK=aJ.getContext('2d');aJ.width=aI.width;aJ.height=aI.height;aK.drawImage(aI,0,0,aJ.width,aJ.height);aJ.toBlob(aL=>{var aM=URL.createObjectURL(aL);f[aE].convertedUrl=aF.href=aM;aF.style.display='inline';var aN=f[aE].filename;aF.download=`${aN}.${toFormat}`;aF.textContent='Download';aH.style.width='100%'},`image/${toFormat}`)}};_E.onloadstart=()=>aH.style.width='25%';_E.onloadend=()=>aH.style.width='50%';_E.readAsDataURL(f[aE].file)}function j(aO,aP){f[aO]=null;aP.remove();f.filter(file=>file!==null).length===0&&(c.style.display='none',A.style.display='none',d.style.display='none')}c.addEventListener('click',()=>{for(const[aQ,aR] of f.entries())if(aR&&!aR.convertedUrl){var aS=b.querySelector(`[data-id='${aQ}']`),aT=aS.querySelector('.downloadLink');i(aQ,aT,aS)}d.style.display='inline'});d.addEventListener('click',()=>{var aU=new JSZip;var aV=aU.folder('converted-files');Promise.all(f.map((aW,aX)=>{if(aW?.convertedUrl)return fetch(aW.convertedUrl).then(res=>res.blob()).then(aY=>aV.file(`${aW.filename}.${toFormat}`,aY));return null})).then(()=>aU.generateAsync({type:'blob'}).then(aZ=>{var bA=document.createElement('a');bA.href=URL.createObjectURL(aZ);bA.download='converted-files.zip';bA.click()}))});A.addEventListener('click',()=>{b.innerHTML='';f.length=0;d.style.display=c.style.display=A.style.display='none'});
